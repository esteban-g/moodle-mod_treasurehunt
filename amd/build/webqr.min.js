function _typeof(a){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("mod_treasurehunt/webqr",["jquery","core/notification","core/str","mod_treasurehunt/instascan"],function(a,b,c,d){var f={camera:-1,scanner:null,detectedCameras:null,setup:function setup(){},enableTest:function enableTest(b){if(!localStorage.getItem("QRScanPassed")){f.loadQR(function(){localStorage.setItem("QRScanPassed","Done");f.unloadQR(function(){a("#QRStatusDiv").html(b)})},f.testFormReport)}else{a("#QRStatusDiv").html(b)}},testFormReport:function testFormReport(c){if("string"==typeof c){a("#QRvalue").text(c);a("#previewQR").hide()}else if("object"===_typeof(c)){if("NotAllowedError"==c.name||0==c.code){b.addNotification({message:a("#errorQR").text(),type:"error"});a("#previewQR").hide();a("#QRStatusDiv").hide()}else{var d=a("#previewQRvideo"),e=d.closest("div"),g=e.width(),h=e.height(),i=d.width(),j=d.height();if(i/j>g/h){d.width(g)}else{d.height(h)}d.css("display","block");var k=c.camera;if(null!==c.cameras[k].name){a("#QRvalue").text(c.cameras[k].name)}a("#previewQR").show();var l=f.getnextwebCam();if(l!=k){if(null!==c.cameras[l].name){a("#idbuttonnextcam").text(l+":"+c.cameras[l].name)}a("#idbuttonnextcam").show()}else{a("#idbuttonnextcam").hide()}}}},enableForm:function enableForm(){a("#id_generateQR").click(f.handleGenerateQR);a("#id_stopQR").click(f.handleStopQR);a("#id_scanQR").click(f.handleScanEditStage)},handleGenerateQR:function handleGenerateQR(){var b=a("#id_qrtext").val();if(""!=b){var c="https://chart.googleapis.com/chart?cht=qr&chs=500x500&chl="+a("#id_qrtext").val();a("#outQRCode").text("");a("#outQRCode").prepend(a("<img>",{id:"theQRImg",src:c,width:"150px",align:"left",title:b}))}else{a("#QRStatusDiv").text("Enter text in QRText field.")}return!1},handleStopQR:function handleStopQR(){f.unloadQR();a("#QRvalue").text("");a("#previewQR").hide();a("#id_stopQR").hide();a("#id_scanQR").show();return!1},handleScanEditStage:function handleScanEditStage(){f.loadQR(function(b){a("#id_qrtext").val(b);f.unloadQR();a("#QRvalue").text("");a("#id_stopQR").hide();a("#id_scanQR").show();a("#previewQR").hide()},f.editFormReport);a("#previewQR").show();a("#previewQRdiv").show();a("#id_stopQR").show();a("#id_scanQR").hide();return!1},editFormReport:function editFormReport(b){if("string"==typeof b){a("#QRvalue").text(b);a("#id_stopQR").hide();a("#id_scanQR").show();a("#previewQRdiv").hide();a("#idbuttonnextcam").hide()}else if("object"===_typeof(b)){if(0==b.code){c.get_string("warnqrscannererror","treasurehunt");a("#outQRCode").text("Camera access error!")}else{var d=b.camera;a("#QRvalue").text(d+":"+b.cameras[d].name);var e=(d+1)%b.cameras.length;if(e!=d){a("#idbuttonnextcam").text(e+":"+b.cameras[e].name);a("#idbuttonnextcam").show()}else{a("#idbuttonnextcam").hide()}}}},unloadQR:function unloadQR(b){if("undefined"==typeof f.scanner){return}f.scanner.stop();f.camera=-1;var c=a("#previewQRvideo");c.hide();if("function"==typeof b){b("")}},loadQR:function loadQR(b,c){var e=a("#previewQRvideo");e.show();f.scanner=new d.Scanner({video:e.get(0),mirror:!1});f.scanner.addListener("scan",b);d.Camera.getCameras().then(function(a){f.detectedCameras=a;if(0<f.detectedCameras.length){f.camera=0;f.scanner.start(f.detectedCameras[f.camera]).then(function(){c({camera:f.camera,cameras:f.detectedCameras})}).catch(function(a){c(a)})}}).catch(function(a){c(a)})},getnextwebCam:function getnextwebCam(){return null===f.detectedCameras||-1===f.camera?0:(f.camera+1)%f.detectedCameras.length},getbackCam:function getbackCam(){var a=f.getnextwebCam();if(null!==f.detectedCameras&&1<f.detectedCameras.length){for(var b=0;b<f.detectedCameras.length;b++){if(null!==f.detectedCameras[b].name&&-1!=f.detectedCameras[b].name.toLowerCase().indexOf("back")){a=b}}}return a},setnextwebcam:function setnextwebcam(a){var b=f.getnextwebCam();if(f.camera!=b){if(null!==f.detectedCameras){try{f.selectCamera(f.detectedCameras,b,a)}catch(b){a(b.message)}}else{d.Camera.getCameras().then(function(c){f.selectCamera(c,b,a)}).catch(function(b){a(b.message)})}}},selectCamera:function selectCamera(b,c,d){if(0<b.length){if(-1==f.camera&&1<b.length){for(var e=0;e<b.length;e++){if(null!==b[e].name&&-1!=b[e].name.toLowerCase().indexOf("back")){c=e}}}f.camera=c;f.scanner.start(b[f.camera]).then(function(){var c=a("#previewQRvideo"),e=c.closest("div"),g=e.width(),h=e.height(),i=c.width(),j=c.height();if(i/j>g/h){c.width(g)}else{c.height(h)}c.css("display","block");d({camera:f.camera,cameras:b})}).catch(function(a){f.scanner.stop();d("Error activating camera: "+a.message)})}else{d("No cameras found.")}}};return f});
//# sourceMappingURL=webqr.min.js.map
